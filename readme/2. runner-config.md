# 概述 summary
### 1. gitlab-ci 的持续集分为哪几部分？
在整个ci 持续集成中， 一般分为以下三个部分（三个类型的job）：
```
stages:
  - build       # 构建部分
  - test        # 测试部分
  - deploy      # 部署部分
```
每一个类型的job 都会有特定的任务和目标， 或许一个job或许多个job；或者同步执行、或许异步执行；此刻我们需要把job进行编排和拆分了：

补充内容：
1. 在多个不同的job 执行中， 如何建立数据共享空间？因为我们是使用的docker,所以我们可以使用数据卷来达到数据共享目的，有那些内容可以共享呢？
    * 最主要的是项目共享：在一次持续集成中，我们可以把任务job 拆分成好几个子任务，每个子任务完成单独的操作，比如 build、test、deploy。 但是他们每一步都是基于上一步来完成的。
    * 当使用docker 作为runner时候，我们也需要对缓存做数据卷，不可能每次去公网去拉去一些内容，这太慢了，比如 composer、 比如npm等等；
    * 我们还需要存储一些ssh 保证项目的安全性。（比如完成公网内网代码部署）

1. build ：主要是项目的构建部分、它构建的范围仅仅只限制于数据卷以内，以保证后面的test job 正常运行。（保证正常的持续交付）
    * 拉去项目： 指定的分支、以及指定的子模块。
    * 如果是分布式项目：则按照分布式项目的规则来拉去相应的代码。
    
2. test ：测试部分
    * 首先在基础服务器 搭建好相应的web 服务，并且建立好web连接
    * 接着配置项目文件的基本信息：比如.env、文件的可写目录等等；
    * 然后进行测试：
        * 测试代码是否符合psr规范
        * 测试项目的缓存文件是否可以自动生成
        * 进行单元测试
    
3. deploy：部署部分  
    * 部署到生产服务器
    * 部署到内测服务器